name: Sync Upstream to mainup

on:
  schedule:
    - cron: '0 3 * * *' # Run daily at 3 AM
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Sync upstream branch
        run: |
          git remote add upstream https://github.com/ff522/dm-ticket.git
          git fetch upstream
          
          # Detect the default branch of upstream
          DEFAULT_BRANCH=$(git symbolic-ref refs/remotes/upstream/HEAD | sed 's@^refs/remotes/upstream/@@')
          if [ -z "$DEFAULT_BRANCH" ]; then
            # Fallback: try common branch names
            if git show-ref --verify --quiet refs/remotes/upstream/main; then
              DEFAULT_BRANCH="main"
            elif git show-ref --verify --quiet refs/remotes/upstream/master; then
              DEFAULT_BRANCH="master"
            else
              echo "Could not determine default branch"
              exit 1
            fi
          fi
          
          echo "Default branch detected: $DEFAULT_BRANCH"
          git push origin --force upstream/$DEFAULT_BRANCH:refs/heads/mainup